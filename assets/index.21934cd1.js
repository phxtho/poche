var he=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var H=(e,t,s)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,w=(e,t)=>{for(var s in t||(t={}))ge.call(t,s)&&H(e,s,t[s]);if(W)for(var s of W(t))xe.call(t,s)&&H(e,s,t[s]);return e},C=(e,t)=>me(e,fe(t));import{u as pe,j as c,a as n,L as ve,m as be,I as ye,n as we,F as Ce,N as Ne,E as ke,b as Ee,R as Re,c as Se,d as Oe,i as Ie,e as _,f as Ae,g as Le,s as _e,h as Fe,k as Me,l as De,o as Te,p as Be,q as Pe,r as je,t as qe,v as $e,w as We,x as He,y as Ve,z as Ue,A as Qe,B as ze,C as Ke,D as Xe,G as Ge,H as r,J as Ye,M as Je,K as Ze,O as et,P as tt,Q as nt,S as st,T as at,U as ot,V as rt,W as lt,X as it,Y as ct,Z as dt,_ as ut,$ as M,a0 as G,a1 as T,a2 as ht,a3 as I,a4 as mt,a5 as V,a6 as ft,a7 as gt,a8 as R,a9 as xt,aa as pt,ab as U,ac as Y,ad as J,ae as vt,af as bt,ag as yt,ah as L,ai as wt,aj as Ct,ak as Nt,al as kt,am as Et,an as Rt,ao as St,ap as Ot,aq as It,ar as At,as as Lt,at as _t,au as Ft,av as Mt,aw as Q,ax as Dt,ay as Z,az as Tt,aA as Bt,aB as Pt,aC as jt,aD as qt,aE as $t,aF as Wt,aG as Ht,aH as Vt,aI as Ut,aJ as Qt,aK as zt,aL as Kt,aM as Xt,aN as S,aO as Gt}from"./vendor.a8a30e08.js";const Yt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}};Yt();const z=e=>{const[{isDragging:t},s,a]=pe({item:e.item,collect:o=>({isDragging:!!o.isDragging()})});return c("div",{id:e.item.id,ref:a,className:"card",style:{display:t&&e.hideSourceOnDrag?"none":"flex",opacity:t?.5:1,top:e.item.y,left:e.item.x},children:[n("div",{className:"flex justify-end p-3",children:n("div",{ref:s,id:`${e.item.id}-drag-handle`,className:"card-drag-handle"})}),e.children]})},O={CARD:"card",COLLECTION:"collection"};class Jt extends ve{constructor(t){super(t);this.addHandler("onClick",(s,a)=>(window.open(a.href),!0))}createInputRules(){return[be({regexp:(()=>{try{return new RegExp("?<!!)[(.*?)]((.*?))")}catch{return/[^!]\[(.+?)\]\((.+?)\)/}})(),type:this.type,getAttributes:t=>{const[s,a,o]=t;return{text:a,href:o}}})]}createPasteRules(){return[]}}class Zt extends ye{createInputRules(){return[we({regexp:/!\[(.+?)\]\((.+?)\)/,type:this.type,getAttributes:t=>{const[s,a,o]=t;return{src:o,alt:a}}})]}}function en(e,t){for(let s of t){let a=s(e);if(a!==!1)return a}return!1}function tn(e,t){return Ce.from(t.text(e))}function nn(e){var s;let t=e.querySelector("img.mwe-math-fallback-image-inline[alt]");return(s=t==null?void 0:t.getAttribute("alt"))!=null?s:!1}function sn(e){var s;let t=e.querySelector("math[alttext]");return(s=t==null?void 0:t.getAttribute("alttext"))!=null?s:!1}function an(e){var s;let t=e.querySelector("math annotation[encoding='application/x-tex'");return(s=t==null?void 0:t.textContent)!=null?s:!1}function on(e){return en(e,[nn,sn,an])}const rn={tag:"span",getAttrs(e){return e.classList.contains("mwe-math-element")?null:!1},getContent(e,t){let a=on(e)||"\\text{\\color{red}(paste error)}";return tn(a,t)}},ln=[rn];var cn=Object.defineProperty,dn=Object.getOwnPropertyDescriptor,ee=(e,t,s,a)=>{for(var o=a>1?void 0:a?dn(t,s):t,l=e.length-1,i;l>=0;l--)(i=e[l])&&(o=(a?i(t,s,o):i(o))||o);return a&&o&&cn(t,s,o),o};let F=class extends Ne{get name(){return"math_inline"}createTags(){return[ke.InlineNode]}createNodeSpec(e,t){return C(w({group:"inline math",content:"text*",inline:!0,atom:!0},t),{attrs:w({},e.defaults()),parseDOM:[{tag:"math-inline"},...ln],toDOM:()=>["math-inline",{class:"math-node"},0]})}createInputRules(){return[Ee(Re,this.type)]}createExternalPlugins(){return[Se]}createKeymap(e){return{Backspace:Oe(_(De),_(Ae),_(Le),_(_e))}}insertMathInline(){return e=>(Ie(this.type),null)}};ee([Fe()],F.prototype,"insertMathInline",1);F=ee([Me({defaultOptions:{}})],F);const un=[Te,Be,Pe,je,qe,$e,We,He,Ve,Ue,Qe,ze,Ke,Xe,Ge],hn=r.exports.forwardRef((e,t)=>{var u;const s=r.exports.useCallback(({json:h,invalidContent:x,transformers:f})=>f.remove(h,x),[]),{manager:a,state:o,setState:l,getContext:i}=Ye({extensions:()=>[new Je({}),new Ze({}),new et,new tt,new Jt({defaultTarget:"_blank",autoLink:!0}),new nt({}),new st({}),new at,new ot,new Zt({enableResizing:!0}),new rt,new lt,new F,new it({supportedLanguages:un,defaultLanguage:"typescript"}),new ct],onError:s,content:(u=e.state)==null?void 0:u.doc});return r.exports.useImperativeHandle(t,()=>i(),[i]),n("div",{className:"remirror-theme",children:n(dt,{manager:a,initialContent:o,onChange:h=>{var x;l(h.state),(x=e.onChange)==null||x.call(e,h)},onFocus:(h,x)=>{var f;(f=e.onFocus)==null||f.call(e,h,x)},onBlur:(h,x)=>{var f;(f=e.onBlur)==null||f.call(e,h,x)},children:n(ut,{})})})});M.plugin(G);let E=new M("notes");const mn={type:"doc",content:[{type:"paragraph"}]};async function B(e){try{const t=e.id||e._id;return await E.upsert(t,a=>e)}catch(t){console.log(`ERROR: couldn't update 
${t}`)}}async function te(e,t,s,a,o,l){try{let i={_id:e||T(),id:null,title:t||null,meta:s||{},state:a||mn,createdTime:o||Date.now(),lastEditedTime:l||Date.now()};return i.id=i._id,await E.putIfNotExists(i)}catch(i){console.log(`ERROR: couldn't create doc ${i}`)}}async function fn(e){try{const t=await E.get(e).then(a=>a._rev);return await E.remove(e,t)}catch(t){console.log(`ERROR: couldn't delete 
${t}`)}}async function D(){var e;try{let t=await E.allDocs({include_docs:!0});return(e=t==null?void 0:t.rows)==null?void 0:e.map(s=>s.doc)}catch(t){console.log(`ERROR fetching all notes 
${t}`)}}async function gn(e){try{return await E.get(e)}catch(t){console.log(`ERROR fetching  ${e} 
${t}`)}}function ne(e){E.changes({since:"now",live:!0}).on("change",()=>e())}async function xn(e){return new ht(await D(),{keys:["title","text"],includeMatches:!0,minMatchCharLength:2,includeScore:!0,threshold:.5,ignoreLocation:!0}).search(e)}let se={items:[],addItem:()=>{},removeItem:()=>{},navOpen:!1,toggleNav:()=>{}};const pn=(e,t)=>e.filter(s=>s!==t),vn=(e,t)=>e.find(s=>s===t)?e:[...e,t],y=r.exports.createContext(se);y.displayName="NotesContext";const bn=e=>{const[t,s]=r.exports.useState(se),a=r.exports.useCallback(i=>{const{items:u}=t;u.find(h=>h===i)||s(C(w({},t),{items:vn(u,i)}))},[t]),o=r.exports.useCallback(i=>{const{items:u}=t;s(C(w({},t),{items:pn(u,i)}))},[t]),l=r.exports.useCallback(()=>{s(C(w({},t),{navOpen:!t.navOpen}))},[t]);return n("div",{className:"App",children:n(y.Provider,{value:C(w({},t),{addItem:a,removeItem:o,toggleNav:l}),children:e.children})})},k=({children:e,className:t,onClick:s})=>n("button",{className:`h-12 w-full px-4 py-3 bg-gray-200 opacity-80 rounded-xl flex justify-between items-center hover:bg-gray-800 hover:text-white ${t}`,onClick:s,children:e}),ae=e=>{var o,l,i;I.setAppElement("#root");const{items:t,removeItem:s}=r.exports.useContext(y),a=(o=e.note)==null?void 0:o.id;return n(I,{isOpen:(l=e.isOpen)!=null?l:!1,onAfterClose:e.onAfterOpen,onRequestClose:e.onRequestClose,overlayClassName:"fixed inset-0 bg-[rgba(30,30,30,.5)]",className:"z-20 bg-gray-100 backdrop-blur-lg rounded-t-xl absolute w-full bottom-0 left-0 right-0 p-4 mx-auto max-w-2xl ",children:c("div",{children:[c("div",{className:"flex justify-between mb-6",children:[c("div",{className:"flex items-center space-x-1 text-xl",children:[n(mt,{}),n("h2",{children:(i=e.note)==null?void 0:i.title})]}),n("button",{className:"rounded-full h-8 w-8 bg-gray-200 opacity-80 hover:bg-gray-800 hover:text-white  flex justify-center items-center",onClick:e.onRequestClose,children:n(V,{})})]}),c("div",{className:"flex flex-col space-y-4 items-center",children:[e.children,t.find(u=>u===a)&&c(k,{onClick:()=>{s(a),e.onRequestClose()},children:[n("span",{children:"Close"})," ",n(V,{})]}),c(k,{onClick:()=>{s(a),fn(a!=null?a:""),e.onRequestClose()},children:[n("span",{children:"Delete"})," ",n(ft,{})]})]})]})})},yn=e=>{const{getHTML:t,getMarkdown:s}=gt();return c(R,{children:[c(k,{onClick:()=>{var h;const l=`<!DOCTYPE html>
    <html>
    <head>
      <link href="https://cdn.jsdelivr.net/npm/base-css-theme@1.1.3/base.css" rel="stylesheet">
    </head>
    <body style="padding: 16px;">${t()}</body>
    </html>`;let i=`${e.note.title}.html`,u=new Blob([l],{type:"text/plain;charset=utf-8"});U.saveAs(u,i),(h=e.onRequestClose)==null||h.call(e)},children:[n("span",{children:"Export HTML"})," ",n(xt,{})]}),c(k,{onClick:()=>{var u;let l=`${e.note.title}.md`,i=new Blob([s()],{type:"text/plain;charset=utf-8"});U.saveAs(i,l),(u=e.onRequestClose)==null||u.call(e)},children:[n("span",{children:"Export Markdown"})," ",n(pt,{})]})]})};const oe=e=>{const[t,s]=r.exports.useState(),[a,o]=r.exports.useState(!1),[l,i]=r.exports.useState(!1),u=r.exports.useRef(),h=r.exports.useRef(),x=Y(),f=r.exports.useCallback(async()=>{if(e.id){let p=await gn(e.id);p&&s(p)}},[e.id]);r.exports.useEffect(()=>{f()},[f]),r.exports.useEffect(()=>{if(x.hash){const p=x.hash.substring(1);e.id===p&&h.current&&h.current.scrollIntoView({behavior:"smooth"})}},[x.hash,e.id]);const d=r.exports.useCallback(p=>{const v=C(w({},t),{state:p.state.toJSON(),lastEditedTime:Date.now()});s(v)},[t]),m=r.exports.useCallback((p,v)=>{t.text=p.helpers.getText(),B(t),o(!1)},[t]),g=r.exports.useCallback((p,v)=>{var $;o(!0),($=e.handleFocus)==null||$.call(e,u.current)},[e]);return t?c(R,{children:[c("div",{id:e.id,ref:h,className:"w-full md:w-5/12 lg:w-1/3 hover:shadow-lg rounded-lg p-5 lg:mr-4 mb-4 editor-container",children:[c("div",{className:"flex justify-between",children:[n("textarea",{placeholder:"Title",defaultValue:t==null?void 0:t.title,className:"font-semibold text-4xl w-11/12",onChange:p=>{let v=p.target.value;v.replace(/\n/,""),t.title=v,B(t)},wrap:"soft"}),n("div",{className:"flex space-x-2",children:n("button",{className:`h-4 w-4 rounded-full opacity-80 border hover:bg-gray-800 hover:border-gray-800 ${a?"border-gray-200 bg-gray-200":"border-gray-200"}`,onClick:()=>i(!0)})})]}),n(hn,{state:t.state,onChange:d,onBlur:m,onFocus:g,ref:u})]}),u.current&&n(J.Provider,{value:u.current,children:n(ae,{isOpen:l,note:t,onRequestClose:()=>{i(!1)},children:n(yn,{note:t,onRequestClose:()=>{i(!1)}})})})]}):null};const wn=e=>{const[t,s]=r.exports.useState([]),a=r.exports.useCallback(async()=>{const o=await D();s(o)},[s]);return r.exports.useEffect(()=>{a(),ne(a)},[a]),n("div",{className:"flex w-64 flex-col rounded items-center divide-y divide-gray-200 divide-opacity-50",children:t.map((o,l)=>{var u;const i=(u=o==null?void 0:o.state)!=null&&u.doc?o.text:"";return n("button",{className:"truncate w-full transition duration-250 ease-in-out bg-gradient-to-r hover:from-gray-100 hover:to-gray-200",onClick:()=>{e.handleNoteButtonClick(o)},children:o.title||i},l)})})};function Cn(){return n(vt,{backend:bt,children:n(Nn,{})})}const Nn=e=>{const[s,a]=r.exports.useState({x:0,y:0}),[o,l]=r.exports.useState({x:0,y:0}),i=[],[,u]=yt({accept:[O.CARD,O.COLLECTION],drop:(d,m)=>{const g=m.getDifferenceFromInitialOffset(),p=Math.round(d.x+g.x),v=Math.round(d.y+g.y);return d.type===O.CARD?x(d.id,p,v):l({x:p,y:v}),{x:p,y:v}}}),h=r.exports.useCallback((d,m)=>{O.CARD,T()},[]),x=r.exports.useCallback((d,m,g)=>{},[]),f=d=>{d==null||d.id,O.CARD};return c("div",{className:"canvas",ref:u,onMouseMove:d=>{a({x:d.nativeEvent.offsetX,y:d.nativeEvent.offsetY})},onDoubleClick:d=>{h(d.nativeEvent.offsetX,d.nativeEvent.offsetY)},children:[!1,n(z,{item:{type:O.COLLECTION,id:T(),x:o.x,y:o.y},children:n(wn,{handleNoteButtonClick:f})}),Object.entries(i).map(([d,m],g)=>n(z,{item:m,hideSourceOnDrag:!0,children:n(oe,{id:m.id})},g))]})};function kn(){const[e,t]=r.exports.useState(!1),[s,a]=r.exports.useState(""),[o,l]=r.exports.useState([]),{addItem:i}=r.exports.useContext(y),u=L(),h=Y(),x=f=>{xn(f).then(d=>l(d))};return c("div",{className:"relative shadow-sm",children:[c("div",{className:"h-10 w-72  rounded-full flex justify-between pl-6 items-center relative",children:[n("input",{placeholder:"Search",className:"w-3/4 h-full bg-transparent overflow-ellipsis",type:"text",value:s,onChange:f=>{const{value:d}=f.target;a(d),x(d)},onFocus:f=>t(!0),onBlur:f=>t(!1)}),n("button",{className:"h-10 w-10 rounded-full bg-black text-white flex justify-center items-center",children:n(wt,{})})]}),s!==""&&o.length>0&&n("div",{className:"search-results rounded-b-lg overflow-hidden",children:o.map(f=>n(En,{onResultClick:()=>{a(""),i(f.item.id),h.pathname!==A.panelWorkspace&&u(A.panelWorkspace)},result:f},f.item.id))})]})}const En=({result:e,onResultClick:t})=>{const s=e.matches.some(o=>o.key==="title"),a=e.matches.some(o=>o.key==="text");return c("button",{className:"result bg-white text-left p-2",onClick:o=>{t==null||t()},children:[c("div",{className:"text-sm",children:[s&&e.matches.map((o,l)=>o.key==="title"?n(K,{match:o},l):null),!s&&e.item.title]}),c("div",{className:"text-xs font-extralight",children:[a&&e.matches.map((o,l)=>o.key==="text"?n(K,{match:o},l):null),!a&&e.item.text]})]})},K=({match:e})=>{var a,o,l,i;const[[t,s]]=e.indices;return c(R,{children:[(a=e.value)==null?void 0:a.substring(0,t),n("span",{className:"bg-yellow-300",children:(o=e.value)==null?void 0:o.substring(t,s)}),(i=e.value)==null?void 0:i.substring(s,(l=e.value)==null?void 0:l.length)]})};function Rn(){return c("div",{className:"min-h-screen",children:[n("div",{id:"top-bar",className:"flex flex-row-reverse p-8",children:n(kn,{})}),n(Cn,{})]})}function re(e){const{addItem:t}=r.exports.useContext(y),s=async()=>{let a=await te();return t(a.id),a.id};return n("button",{onClick:async()=>{var o;const a=await s();(o=e==null?void 0:e.handleClick)==null||o.call(e,a)},className:"bg-gray-200  text-black backdrop-blur-xl rounded-full h-16 w-16 fixed right-1 bottom-12 md:right-8 md:bottom-8 flex justify-center items-center shadow-md hover:pointer hover:opacity-100 hover:bg-green-500 hover:text-white",children:n(Ct,{})})}const N=e=>e?"active":"",Sn=()=>{const e=Nt(),t=kt();return c("div",{className:"toolbar space-x-2",children:[n("button",{onClick:()=>{e.undo(),e.focus()},children:n(Et,{})}),n("button",{onClick:()=>{e.redo(),e.focus()},children:n(Rt,{})}),n("button",{className:N(t.bold()),onClick:()=>{e.toggleBold(),e.focus()},children:n(St,{})}),n("button",{className:N(t.italic()),onClick:()=>{e.toggleItalic(),e.focus()},children:n(Ot,{})}),n("button",{className:N(t.underline()),onClick:()=>{e.toggleUnderline(),e.focus()},children:n(It,{})}),n("button",{className:N(t.code()),onClick:()=>{e.toggleCode(),e.focus()},children:n(At,{})}),n("button",{className:N(t.blockquote()),onClick:()=>{e.toggleBlockquote(),e.focus()},children:n(Lt,{})}),n("button",{className:N(t.bulletList()),onClick:()=>{e.toggleBulletList(),e.focus()},children:n(_t,{})}),n("button",{className:N(t.taskList()),onClick:()=>{e.toggleTaskList(),e.focus()},children:n(Ft,{})})]})};function On(){const{items:e}=r.exports.useContext(y),[t,s]=r.exports.useState(),a=L();return r.exports.useEffect(()=>{e.length===0&&a(A.home)},[e]),c(R,{children:[n("div",{className:"editor-list",children:e.map(o=>n(oe,{id:o,handleFocus:l=>s(l)},o))}),t&&n(J.Provider,{value:t,children:n(Sn,{})}),n(re,{})]})}function In(){const[e,t]=r.exports.useState([]),[s,a]=r.exports.useState(!1),[o,l]=r.exports.useState(),i=L(),{items:u,addItem:h}=r.exports.useContext(y),x=r.exports.useCallback(async()=>{const d=await D();t(d)},[t]),f=d=>{l(d),a(!0)};return r.exports.useEffect(()=>(x(),ne(x),()=>{t([])}),[x]),c(R,{children:[c("div",{className:"p-5",children:[c("table",{className:"rounded-lg divide-y divide-gray-200 note-list shadow-md",children:[n("thead",{children:c("tr",{children:[n("th",{className:"w-11/12 lg:w-9/12",children:"Note"}),n("th",{className:"hidden lg:block w-2/12",children:"Edited"}),n("th",{className:"w-1/12"})]})}),n("tbody",{children:e.sort((d,m)=>d.lastEditedTime<m.lastEditedTime?1:-1).map((d,m)=>c("tr",{id:`row-${d.id}`,children:[n("td",{children:n("button",{className:"truncate w-full transition duration-250 ease-in-out bg-gradient-to-r hover:from-gray-100 hover:to-gray-200",onClick:()=>{h(d.id),i(`${A.panelWorkspace}#${d.id}`)},children:c("div",{className:"flex flex-col text-left",children:[c("div",{className:"font-medium flex space-x-1",children:[n("span",{children:d.title||"No Title"}),n("span",{className:`rounded-full h-2 w-2 bg-green-500 ${u.find(g=>g==d.id)?"inline":"hidden"} `})]}),n("span",{className:"text-sm text-gray-500 font-light",children:d.text||"empty"})]})})}),n("td",{className:"hidden md:block",children:new Date(d.lastEditedTime).toLocaleString(navigator.language,{year:"numeric",month:"long",day:"numeric"})}),n("td",{children:n("button",{onClick:()=>f(d),children:n(Mt,{})})})]},m))})]}),n(re,{handleClick:d=>i(`/poche/p#${d}`)})]}),n(ae,{isOpen:s,note:o,onRequestClose:()=>{l(null),a(!1)}})]})}M.plugin(G);let q=new M("peers");function An(e){q.changes({since:"now",live:!0}).on("change",()=>e())}async function Ln(e){try{const t=e.id||e._id;return await q.upsert(t,a=>e)}catch(t){console.log(`ERROR: couldn't upsert 
${t}`)}}async function X(){var e;try{let t=await q.allDocs({include_docs:!0});return(e=t==null?void 0:t.rows)==null?void 0:e.map(s=>s.doc)}catch(t){console.log(`ERROR fetching all peers 
${t}`)}}let P,b,j;P=localStorage.getItem("peerId");try{b=new Q(P)}catch{b=new Q,P=b.id}b.on("open",function(e){localStorage.setItem("peerId",e),console.log("My peer ID is: "+e)});b.on("connection",e=>{console.log(`Connected to ${e.peer}`),Object.keys(b.connections).forEach(t=>{le(t)}),e=e,e.on("open",()=>{e.on("data",t=>{console.log(`Recieved data from ${e.peer}`),console.log(t),Array.isArray(t)&&t.forEach(s=>B(s))})})});b.on("error",e=>{console.error(e)});const le=e=>{Ln({id:e})};function ie(e){try{j=b.connect(e,{serialization:"json"}),Object.keys(b.connections).forEach(t=>{le(t)})}catch(t){console.log(t)}}async function ce(){try{j.on("open",async()=>{let e=await D();j.send(e),console.log("data sent")})}catch(e){console.log(e)}}const de=()=>{const[e,t]=r.exports.useState([]);return r.exports.useEffect(()=>(X().then(s=>t(s)),An(s=>X().then(a=>t(a))),()=>{t([])}),[]),n("div",{className:"flex space-x-2",children:e==null?void 0:e.map((s,a)=>n("button",{className:"rounded-3xl shadow-lg bg-black text-white h-10 w-10 flex flex-col justify-center items-center overflow-hidden ",children:n(Dt,{})},a))})};function _n(){const[e,t]=r.exports.useState(""),[s,a]=r.exports.useState();r.exports.useEffect(()=>{var i;let l=document.getElementById("qrcode");(i=Z)==null||i.toCanvas(l,localStorage.getItem("peerId")),document.getElementById("videoOutCanvas")},[]);let o=()=>{requestAnimationFrame(o)};return requestAnimationFrame(o),c(R,{children:[c("div",{className:"flex",children:[c("div",{className:"flex flex-col",children:[n("input",{className:"border border-black",type:"text",value:e,onChange:l=>{t(l.target.value)}}),n("button",{className:"rounded bg-blue-500 text-white",onClick:l=>{ie(e)},children:"Connect"})]}),c("div",{className:"flex flex-col",children:[n("textarea",{className:"border border-black",onChange:l=>{a(l.target.value)}}),n("button",{className:"bg-green-500 text-white rounded",onClick:l=>{ce()},children:"Send"})]})]}),n(de,{}),n("canvas",{id:"videoOutCanvas",hidden:!0}),n("video",{id:"video"})]})}const Fn={content:{borderRadius:".5rem",height:"fit-content",maxWidth:"40rem",marginLeft:"auto",marginRight:"auto"}};I.setAppElement("#root");const Mn=e=>{const[t,s]=r.exports.useState(),[a,o]=r.exports.useState(null),l=r.exports.useCallback(i=>{i!==null&&o(i)},[]);return r.exports.useEffect(()=>{const i=localStorage.getItem("peerId");s(i)},[]),r.exports.useEffect(()=>{var i;a&&((i=Z)==null||i.toCanvas(a,t))},[t,a]),n(I,{isOpen:e.isOpen,onAfterClose:e.onAfterOpen,onRequestClose:e.onRequestClose,style:Fn,children:c("div",{className:"flex flex-col justify-center items-center",children:[n("canvas",{id:"qrcode",ref:l}),n("p",{className:"text-center",children:t})]})})},Dn={content:{borderRadius:".5rem",height:"fit-content",maxWidth:"40rem",marginLeft:"auto",marginRight:"auto"}};I.setAppElement("#root");const Tn=e=>{const[t,s]=r.exports.useState(null),[a,o]=r.exports.useState(null),[l,i]=r.exports.useState(""),[u,h]=r.exports.useState(),x=r.exports.useCallback(m=>{m!==null&&s(m)},[]),f=r.exports.useCallback(m=>{m!==null&&o(m)},[]);r.exports.useEffect(()=>{const m={video:{facingMode:"environment",frameRate:{ideal:10,max:15}}};try{navigator.mediaDevices.getUserMedia(m).then(g=>{h(g),a&&(a.srcObject=g,a.setAttribute("playsinline","true"),a.play(),requestAnimationFrame(d))})}catch(g){console.log(`Couldn't set up video stream 
:${g}`)}return()=>{d=null,u==null||u.getTracks().forEach(g=>{g.stop()})}},[a]),r.exports.useEffect(()=>{!e.isOpen&&(u==null?void 0:u.active)&&u.getTracks().forEach(m=>{m.stop()})},[e.isOpen,u]);let d=()=>{if(a&&a.readyState===a.HAVE_ENOUGH_DATA){let p=t.getContext("2d");t.height=a.videoHeight,t.width=a.videoWidth,p.drawImage(a,0,0,t.width,t.height);var m=p.getImageData(0,0,t.width,t.height),g=Tt(m.data,m.width,m.height,{inversionAttempts:"dontInvert"});g!=null&&g.data&&(console.log("Got QR Code"),console.log(g.data),i(g.data),e==null||e.onScanned(g.data),d=null)}d&&requestAnimationFrame(d)};return c(I,{isOpen:e.isOpen,onAfterClose:e.onAfterOpen,onRequestClose:e.onRequestClose,style:Dn,children:[n("canvas",{id:"videoOutCanvas",ref:x,hidden:!0}),n("video",{id:"video",ref:f})]})},Bn=5e5,Pn=({onUpload:e,maxFileSize:t=Bn,multiple:s=!1,accept:a="*"})=>{const o=r.exports.useRef(null);return c("section",{children:[c("button",{type:"button",className:"flex space-x-2 items-center bg-black text-white px-5 py-2 rounded-3xl",onClick:l=>o.current.click(),children:[n(Bt,{}),c("span",{children:[" Upload ",s?"files":"a file"]})]}),n("input",{type:"file",ref:o,title:"",value:"",accept:a,className:"hidden",onChange:l=>{const{files:i}=l.target;i.length&&(e==null||e(i))}})]})};function jn(e){const t=new FileReader;for(let s=0;s<e.length;s++){const a=e[s];t.onload=o=>{const l=o.target.result,u=new Pt.Renderer().render(l),h=a.name.replace(".html","");te(null,h,null,{doc:u,selection:null})},a.type==="text/html"&&t.readAsText(a)}}const qn=()=>{const[e,t]=r.exports.useState(!1),[s,a]=r.exports.useState(!1);return c(R,{children:[c("div",{className:"p-5",children:[n("h1",{children:"Import HTML"}),n(Pn,{accept:".html",onUpload:o=>jn(o)}),n("h1",{children:"Replication"}),c("div",{className:"flex flex-col items-center",children:[n("h3",{children:"Connected Devices"}),n(de,{}),n("h3",{children:"Add Devices"}),c("div",{className:"flex items-center justify-center w-full flex-wrap md:space-x-4",children:[c("button",{className:"rounded-3xl bg-black text-white flex space-x-1 p-2 items-center justify-center w-full md:w-1/3 mb-2",onClick:()=>t(!0),children:[n(jt,{})," ",n("span",{children:"Show QR Code"})]}),c("button",{className:"rounded-3xl bg-black text-white flex space-x-1 p-2 items-center justify-center w-full md:w-1/3 mb-2",onClick:()=>a(!0),children:[n(qt,{})," ",n("span",{children:"Scan"})]})]})]})]}),n(Mn,{isOpen:e,onRequestClose:()=>t(!1)}),n(Tn,{isOpen:s,onRequestClose:()=>a(!1),onScanned:async o=>{ie(o),await ce(),a(!1)}})]})},$n=()=>{const e=L();return c("div",{className:"flex space-x-4",children:[n("button",{className:"rounded-full h-8 w-8 bg-gray-200 hover:opacity-80 hover:bg-gray-800 hover:text-white  flex justify-center items-center",onClick:()=>e(-1),children:n($t,{})}),n("button",{className:"rounded-full h-8 w-8 bg-gray-200 hover:opacity-80 hover:bg-gray-800 hover:text-white  flex justify-center items-center",onClick:()=>e(1),children:n(Wt,{})})]})},Wn=()=>{const{toggleNav:e}=r.exports.useContext(y);return n("button",{className:"rounded-full h-8 w-8 bg-white opacity-80 hover:bg-gray-800 hover:text-white  flex justify-center items-center",onClick:e,children:n(Ht,{})})},Hn=()=>{const e=L(),{navOpen:t}=r.exports.useContext(y);return c("div",{className:`h-fit bg-gray-200 backdrop-blur-lg rounded-r-xl shadow-lg flex flex-col space-y-2 items-center py-5 px-1  shrink-0 fixed bottom-0 top-0 left-0 my-auto 
      md:w-32
      ${t?"block":"hidden"}`,children:[c(k,{onClick:()=>e(A.home),children:[n(Vt,{})," ",n("span",{className:"hidden md:block",children:"Home"})]}),c(k,{children:[n(Ut,{})," ",n("span",{className:"hidden md:block",children:"Search"})]}),c(k,{onClick:()=>e(A.settings),children:[n(Qt,{})," ",n("span",{className:"hidden md:block",children:"Settings"})]})]})},Vn=e=>c("div",{className:"min-h-screen max-w-full h-full",children:[c("div",{className:"w-full flex justify-between items-center mb-2 py-2 px-3",children:[n(Wn,{}),n("div",{children:n($n,{})})]}),c("div",{className:"flex flex-row-reverse",children:[n("div",{className:"w-full overflow-scroll",children:n(zt,{})}),n(Hn,{})]})]});function Un(e){return n(Kt,{children:n(Xt,{children:c(S,{path:"poche",element:n(Vn,{}),children:[n(S,{index:!0,element:n(In,{})}),n(S,{path:"canvas",element:n(Rn,{})}),n(S,{path:"panel",element:n(On,{})}),n(S,{path:"settings",element:n(qn,{})}),n(S,{path:"demo",element:n(_n,{})})]})})})}const A={home:"/poche",settings:"/poche/settings",panelWorkspace:"/poche/panel"};function Qn(){return n(bn,{children:n(Un,{})})}const zn=Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Kn(e){if("serviceWorker"in navigator){if(new URL({}.PUBLIC_URL,window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const s=`${{}.PUBLIC_URL}/service-worker.js`;zn?(Xn(s,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})):ue(s,e)})}}function ue(e,t){navigator.serviceWorker.register(e).then(s=>{s.onupdatefound=()=>{const a=s.installing;a!=null&&(a.onstatechange=()=>{a.state==="installed"&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(s)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(s)))})}}).catch(s=>{console.error("Error during service worker registration:",s)})}function Xn(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(s=>{const a=s.headers.get("content-type");s.status===404||a!=null&&a.indexOf("javascript")===-1?navigator.serviceWorker.ready.then(o=>{o.unregister().then(()=>{window.location.reload()})}):ue(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}Gt.render(n(r.exports.StrictMode,{children:n(Qn,{})}),document.getElementById("root"));Kn();
